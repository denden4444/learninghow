<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>jQuery Add / Remove Table Rows Dynamically</title>
<script src="WebSocket.js" type="text/javascript"></script>
<style type="text/css">
    form{
        margin: 20px 0;
    }
    form input, button{
        padding: 5px;
    }
    table{
        width: 100%;
        margin-bottom: 20px;
		border-collapse: collapse;
    }
    table, th, td{
        border: 1px solid #cdcdcd;
    }
    table th, table td{
        padding: 10px;
        text-align: left;
    }
</style>
<link rel="stylesheet" type="text/css" href="flatpickr.min.css">
<script src="flatpickr.js"></script>
<script type="text/javascript" src="jquery-1.12.4.min.js"></script> 
    
	
<script type="text/javascript">
    $(document).ready(function(){
	
	//create a date/time string to be used in the file name
	var now = new Date();
	var currentDateTimeString = now.getMonth()+1 + '-' + now.getDate() + '-' + now.getFullYear() + '-' + now.getHours() + now.getMinutes() + now.getSeconds();
	alert(currentDateTimeString);
	var new_device;
	var new_device_unix;
	//$('#onTime').flatpickr();
	flatpickr('#onTime',{
    enableTime: true,
    dateFormat: "Y-m-d H:i,U",
	enableSeconds: true,
});
flatpickr('#offTime',{
    enableTime: true,
    dateFormat: "Y-m-d H:i,U",
	enableSeconds: true,
});
	flatpickr('.calendar',{
    enableTime: true,
    dateFormat: "Y-m-d H:i,U",
	enableSeconds: true,
	mode: "multiple",
});
	
	flatpickr('.flatpickr',{
    enableTime: true,
    dateFormat: "Y-m-d H:i,U",
	enableSeconds: true,
	mode: "range",
});

        $(".add-row").click(function(){
            var name = $("#name").val();
            var location = $("#location").val();
			var onTime = $("#onTime").val(); 
			//split the values here for unixtime
			var onTime_cut = $("#onTime").val().split(',');
			alert(onTime_cut[0]);
			alert(onTime_cut[1]);
						
			var offTime = $("#offTime").val();
			//split the values here for unixtime
			var offTime_cut = $("#onTime").val().split(',');
			alert(offTime_cut[0]);
			alert(offTime_cut[1]);
			
			var pattern = $("#pattern").val();
			var hcode = $("#hcode").val();
			var pcode = $("#pcode").val();
            var markup = "<tr><td><input type='checkbox' name='record'></td><td>" + name + "</td><td>" + location + "</td><td>" + onTime + "</td><td>" + offTime + "</td><td>" + pattern + "</td><td>" + hcode + "</td><td>" + pcode + "</td></tr>";
            var new_device = name + "," + location + "," + onTime + "," + offTime + "," + pattern + "," + hcode + "," + pcode ;
			alert(new_device);
			var new_device_unix = "#" + name + "," + location + "," + onTime_cut[1] + "," + offTime_cut[1] + "," + pattern + "," + hcode + "," + pcode ;
			alert(new_device_unix);
			var cars = ["#",name ,location,onTime_cut[1],offTime_cut[1],pattern,hcode,pcode];
			alert(cars);
			connection.send(cars);
			$("table tbody").append(markup);
			
			
//end of add row function 
        });
        
        // Find and remove selected table rows
        $(".delete-row").click(function(){
            $("table tbody").find('input[name="record"]').each(function(){
            	if($(this).is(":checked")){
                    $(this).parents("tr").remove();
                }
            });
        });
    
	
	
	//last line bofre main function ends
	});    
</script>
</head>
<body>
    <form>
        <input type="text" id="name" placeholder="Device Name">
        <input type="text" id="location" placeholder="Location">
		<input type="text" id="onTime" placeholder="onTime">
		<input type="text" id="offTime" placeholder="offTime">
		<input class=calendar data-enabletime=true>
		<input class=flatpickr data-enabletime=true>
		<select id="pattern">
				<option value="Normal">Normal</option>
				<option value="MinRepeat">MRepeat</option>
				<option value="HRepeat">HRepeat</option>
				<option value="MRepeat">MRepeat</option>
				<option value="MRepeat">YRepeat</option>
				<option value="Random">Random</option>
		</select> 
		<input type="text" id="hcode" placeholder="hcode">
		<input type="text" id="pcode" placeholder="pcode">
		
    	<input type="button" class="add-row" value="Schedule a device">
		
    </form>
    <table>
        <thead>
            <tr>
                <th th id="thselect"> Select <input type="checkbox" name="allrecord"> </th>
                <th th id="thdeviceName" >Device Name</th>
                <th id="thLocation">Location</th>
				<th id="thon_time">On Time</th>
				<th id="thoff_time">Off Time</th>
				<th id="thpattern">Pattern options</th>
				<th id="thHcode">HCode</th>
				<th id="thPcode">PCode</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td headers="select"><input type="checkbox" name="record"></td>
                <td>Light1</td>
                <td>Lounge</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
            </tr>
        </tbody>
    </table>
    <button type="button" class="delete-row">Delete Row</button>
</body> 
</html> 